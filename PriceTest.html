<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rental Calculator Demo</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    label { display: grid; grid-template-columns: 160px minmax(0, 180px); gap: 12px; align-items: center; margin: 0; }
    input, select { padding: 0.3em; width: 100%; box-sizing: border-box; }
    button { margin-top: 1em; padding: 0.5em 1em; }
    .result { margin-top: 2em; padding: 1em; border: 1px solid #ccc; }
    .result h3 { margin-top: 0; }
    .form-section, .chart-controls { display: grid; gap: 12px; max-width: 520px; }
    .chart-controls h3 { margin: 0; }
  </style>
</head>
<body>
  <h1>Rental Calculator</h1>

  <div class="form-section">
    <label>
      Quantity:
      <input type="number" id="quantity" value="150">
    </label>
    <label>
      Base Rate:
      <input type="number" id="baseRate" value="4.98" step="0.01">
    </label>
    <label>
      Days:
      <input type="number" id="days" value="5">
    </label>
    <label>
      SKU:
      <input type="text" id="sku" value="default">
    </label>
  </div>

  <button onclick="runCalc()">Calculate</button>

  <div class="result" id="output"></div>

  <h2>Charts</h2>

  <div class="chart-controls">
    <h3>Total vs Quantity</h3>
    <label>
      Plot:
      <select id="qtyChartMetric">
        <option value="discountedPrice">Discounted Price</option>
        <option value="totalDiscount">Total Discount</option>
        <option value="discountPct">Percent Discount</option>
      </select>
    </label>
    <label>
      Step:
      <input type="number" id="qtyChartStep" value="1">
    </label>
    <button onclick="chartRenderer.plotQuantityChart()">Plot Quantity Chart</button>
  </div>

  <canvas id="quantityChart" width="600" height="300"></canvas>

  <div class="chart-controls">
    <h3>Total vs Days</h3>
    <label>
      Plot:
      <select id="dayChartMetric">
        <option value="discountedPrice">Discounted Price</option>
        <option value="totalDiscount">Total Discount</option>
        <option value="discountPct">Percent Discount</option>
      </select>
    </label>
    <label>
      Step:
      <input type="number" id="dayChartStep" value="1">
    </label>
    <button onclick="chartRenderer.plotDayChart()">Plot Days Chart</button>
  </div>

  <canvas id="dayChart" width="600" height="300"></canvas>

<!-- Pricing data embedded as JSON -->
<script type="application/json" id="pricingDataJson">
{
  "pricingRules": {
    "default": {
      "calculateHandlingFee": true,
      "quantityTiers": [
        { "from": 1, "discount": 0.00 },
        { "from": 101, "discount": 0.10 },
        { "from": 201, "discount": 0.20 },
        { "from": 301, "discount": 0.30 },
        { "from": 401, "discount": 0.40 },
        { "from": 501, "discount": 0.50 },
        { "from": 601, "discount": 0.60 },
        { "from": 701, "discount": 0.70 },
        { "from": 801, "discount": 0.80 },
        { "from": 901, "discount": 0.90 }
      ],
      "dayDiscounts": [
        { "day": 1, "discount": 0.00 },
        { "day": 2, "discount": 0.15 },
        { "day": 3, "discount": 0.25 },
        { "day": 4, "discount": 0.35 },
        { "day": 5, "discount": 0.45 },
        { "day": 6, "discount": 0.55 },
        { "day": 7, "discount": 0.575 },
        { "day": 8, "discount": 0.65 },
        { "day": 9, "discount": 0.725 },
        { "day": 10, "discount": 0.755 },
        { "day": 11, "discount": 0.785 },
        { "day": 15, "discount": 0.815 },
        { "day": 20, "discount": 0.845 },
        { "day": 30, "discount": 0.875 },
        { "day": 60, "discount": 0.905 },
        { "day": 90, "discount": 0.935 }
      ],
      "handlingFees": [
        { "from": 1, "fee": 99 },
        { "from": 11, "fee": 149 },
        { "from": 31, "fee": 249 },
        { "from": 101, "fee": 399 },
        { "from": 301, "fee": 599 },
        { "from": 501, "fee": 799 }
      ]
    },
    "sku_headphones": {
      "baseRate": 500.00,
      "calculateHandlingFee": false,
      "quantityTiers": [
        { "from": 1, "discount": 0.00 },
        { "from": 50, "discount": 0.05 },
        { "from": 100, "discount": 0.10 }
      ],
      "dayDiscounts": [
        { "day": 1, "discount": 0.00 },
        { "day": 7, "discount": 0.20 },
        { "day": 14, "discount": 0.30 }
      ],
      "handlingFees": []
    }
  }
}

</script>

<script>
// Parse embedded JSON data
const pricingData = JSON.parse(document.getElementById('pricingDataJson').textContent);
</script>

<!-- Chart.js library (local) -->
<script src="./chart.umd.min.js"></script>

<!-- Pricing engine (core business logic) -->
<script src="./pricing.js"></script>

<!-- Chart renderer for testing UI -->
<script src="./chart-renderer.js"></script>

<!-- Initialize chart renderer and test UI -->
<script>
let chartRenderer;

// Initialize on page load
document.addEventListener('DOMContentLoaded', () => {
  chartRenderer = new ChartRenderer(pricingData);
});

// Test UI: Calculate button handler
function runCalc() {
  const qty = parseInt(document.getElementById("quantity").value, 10);
  const baseRate = parseFloat(document.getElementById("baseRate").value);
  const days = parseInt(document.getElementById("days").value, 10);
  const sku = document.getElementById("sku").value.trim();

  const engine = new PricingEngine(pricingData);
  const result = engine.calculateRental(qty, days, sku, baseRate);

  document.getElementById("output").innerHTML = `
    <h3>Results for SKU: ${result.sku}</h3>
    <p>Effective Quantity: ${result.effectiveQty.toFixed(2)}</p>
    <p>Handling Fee: $${result.handlingFee.toFixed(2)}</p>
    <p>Discounted Price: $${result.discountedPrice.toFixed(2)}</p>
    <p>Discounted Daily rate: $${result.discountedDailyRate.toFixed(2)}</p>
    <p><strong>Total: $${result.total.toFixed(2)}</strong></p>
   
    <p>Original Price (no discounts): $${result.originalPrice.toFixed(2)}</p>
    <p>Total Discount: $${result.totalDiscount.toFixed(2)}</p>
  `;

  chartRenderer.plotQuantityChart();
  chartRenderer.plotDayChart();
}
</script>
</body>
</html>
